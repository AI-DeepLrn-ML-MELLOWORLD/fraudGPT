<html>

<head>
    <title>Fraud GPT</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"
        integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.5.0/semantic.min.js"
        integrity="sha512-Xo0Jh8MsOn72LGV8kU5LsclG7SUzJsWGhXbWcYs2MAmChkQzwiW/yTQwdJ8w6UA9C6EVG18GHb/TrYpYCjyAQw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-serialize-object/2.5.0/jquery.serialize-object.min.js"
        integrity="sha512-Gn0tSSjkIGAkaZQWjx3Ctl/0dVJuTmjW/f9QyB302kFjU4uTNP4HtA32U2qXs/TRlEsK5CoEqMEMs7LnzLOBsA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.5.0/semantic.min.css"
        integrity="sha512-KXol4x3sVoO+8ZsWPFI/r5KBVB/ssCGB5tsv2nVOKwLg33wTFP3fmnXa47FdSVIshVTgsYk/1734xSk9aFIa4A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style type="text/css">
        body {
            background-color: #DADADA;
        } 

        body>.grid {
            height: 100%;
        }

        .image {
            margin-top: -100px;
        }

        .column {
            max-width: 450px;
        }

        .hidden {
            visibility: collapse;
            display: none !important;
        }
        .score {
            font-size: 8em !important;
        }
        .vault_image {
            width: 20em;
        }
        .column {
            max-width: unset !important;
            margin-left: 10em;
            margin-right: 10em;
        }
        .vault_description {
            font-size: xx-small;
        }
        .prop {
            margin-top: 10px !important;
            margin-left: 10px !important;
            margin-right: 10px !important;
        }
    </style>
</head>

<body>
    <div class="ui middle aligned center aligned grid initial">
        <div class="column">
            <h2 class="ui image header">
                <img src="/logo-sm.png" class="image">
                <div class="content">
                    Enter Marketplace URL
                </div>
            </h2>
            <form class="ui large form">
                <div class="ui stacked segment">
                    <div class="field">
                        <div class="ui left icon input">
                            <i class="cart arrow down icon"></i>
                            <input type="text" name="url" placeholder="url...">
                        </div>
                    </div>
                    <div class="ui fluid large submit button">Get Fraud Score</div>
                </div>

                <div class="ui error message"></div>

            </form>
            <div class="ui message">
                New to Emblem Vault? <a href="https://emblem.finance">Visit us today</a>
            </div>
        </div>
    </div>
    <div class="ui middle aligned center aligned grid hidden display" >
        <div class="column">
            <div class="ui fluid large submit button back">Investigate another listing</div>
            <div class="ui raised very padded text container segment ">
                <p class="ui header score"></p>
                <p><img class="ui medium rounded vault_image" src=""></p>
                <p class="vault_name"></p>
                <p class="vault_description"></p>
                <h3>Vault address</h3>
                <p class="vault_address"></p>
                <h3>Ordinal Owner</h3>
                <p class="ordinal_owner"></p>
                <h3>What's described as in the vault</h3>
                <p class="properties"></p>
                <h3>What's actually in the vault</h3>
                <p class="balances"></p>     
                <h3>Risk Score Reasons</h3>
                <p class="reasons"></p>              
            </div>
            <div class="ui message">
                New to Emblem Vault? <a href="https://emblem.finance">Visit us today</a>
            </div>
        </div>
    </div>
    <script>
        $('.back').click(()=>{
            $(".initial").addClass('visible')
            $(".initial").removeClass('hidden')
            $(".display").removeClass('visible')
            $(".display").addClass('hidden')
        })
        $('form .submit.button')
            .api({
                url: '/v1/meta/',
                serializeForm: true,
                beforeSend: function (settings) {
                    $(".error").addClass('hidden')
                    settings.urlData = { url: settings.data.url }
                    return settings;
                },
                onResponse: function (response) {
                    $(".display").removeClass('hidden')
                    $(".initial").addClass('hidden')
                    return response;
                },onSuccess: function(response) {
                    $(".score").text(response.properties.risk)
                    switch(response.properties.risk){
                        case "low":
                            $(".score").addClass("green")
                            break;
                        case "med":
                            $(".score").addClass("orange")
                            break;
                        case "high":
                            $(".score").addClass("red")
                            break;
                    }
                    $(".vault_image").attr('src', response.liveMetadata.media.length > 0? response.liveMetadata.media[0].raw: !response.metadata.image.includes("ipfs")? `response.metadata.image`: `https://gateway.ipfs.io/ipfs/${response.metadata.image_ipfs}`)
                    $('.vault_name').html(response.assetName)
                    $('.vault_description').html(response.description)
                    $('.vault_address').html(response.vaultBtcAddress)
                    response.properties.isOrdinal? $('.ordinal_owner').html(response.ordinalOwner): {}
                    displayProperties(response.properties)
                    response.balances.length >0 ? displayBalances(response.balances): $(".balances").html("Empty Vault")
                    response.properties.reasons.length > 0? displayReasons(response.properties.reasons): {}
                },
                onFailure: function(response) {
                    $(".error.message").html(`error: ${response.message}`)
                    $(".error").addClass('visible')
                    $(".error").removeClass('hidden')
                }
            })
            function displayProperties(properties) {
                $(".properties").html("")
                Object.keys(properties).forEach(item=>{
                    item != "inscriptionLink" && item != "reasons"?  $(".properties").append(createPropertyItem(item, properties[item])): {}
                })
            }
            function displayBalances(balances) {
                $(".balances").html("")
                balances.forEach((balance, index)=>{
                    Object.keys(balance).forEach(item=>{
                        $(".balances").append(createPropertyItem(item, balances[index][item]))
                    })
                })
            }
            function displayReasons(reasons) {
                $(".reasons").html("")
                reasons.forEach((reason, index)=>{
                   $(".reasons").append(createReasonItem(reason))                    
                })
            }
            function createPropertyItem(name, value) {
                return `<div class="prop ui blue image label">
                            ${name}
                            <div class="detail">
                                ${value}
                            </div>
                        </div>`
            }
            function createReasonItem(reason) {
                let color =  reason[0] == "+" ? "green" : "red"
                return `<div class="prop ui ${color} image label">
                            ${reason}
                        </div>`
            }
    </script>
</body>

</html>